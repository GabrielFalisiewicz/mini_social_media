{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nvar _asyncToGenerator = require(\"C:/Users/GabrielFalisiewiczS/OneDrive/Dokumenty/Udemy/backend/kurs1/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CoreSchemaRegistry = exports.SchemaValidationException = void 0;\nconst ajv_1 = __importDefault(require(\"ajv\"));\nconst ajv_formats_1 = __importDefault(require(\"ajv-formats\"));\nconst http = __importStar(require(\"http\"));\nconst https = __importStar(require(\"https\"));\nconst rxjs_1 = require(\"rxjs\");\nconst Url = __importStar(require(\"url\"));\nconst exception_1 = require(\"../../exception\");\nconst utils_1 = require(\"../../utils\");\nconst utils_2 = require(\"../utils\");\nconst utility_1 = require(\"./utility\");\nconst visitor_1 = require(\"./visitor\");\nclass SchemaValidationException extends exception_1.BaseException {\n  constructor(errors, baseMessage = 'Schema validation failed with the following errors:') {\n    if (!errors || errors.length === 0) {\n      super('Schema validation failed.');\n      this.errors = [];\n      return;\n    }\n    const messages = SchemaValidationException.createMessages(errors);\n    super(`${baseMessage}\\n  ${messages.join('\\n  ')}`);\n    this.errors = errors;\n  }\n  static createMessages(errors) {\n    if (!errors || errors.length === 0) {\n      return [];\n    }\n    const messages = errors.map(err => {\n      let message = `Data path ${JSON.stringify(err.instancePath)} ${err.message}`;\n      if (err.params) {\n        switch (err.keyword) {\n          case 'additionalProperties':\n            message += `(${err.params.additionalProperty})`;\n            break;\n          case 'enum':\n            message += `. Allowed values are: ${err.params.allowedValues?.map(v => `\"${v}\"`).join(', ')}`;\n            break;\n        }\n      }\n      return message + '.';\n    });\n    return messages;\n  }\n}\nexports.SchemaValidationException = SchemaValidationException;\nclass CoreSchemaRegistry {\n  constructor(formats = []) {\n    this._uriCache = new Map();\n    this._uriHandlers = new Set();\n    this._pre = new utils_1.PartiallyOrderedSet();\n    this._post = new utils_1.PartiallyOrderedSet();\n    this._smartDefaultKeyword = false;\n    this._sourceMap = new Map();\n    this._ajv = new ajv_1.default({\n      strict: false,\n      loadSchema: uri => this._fetch(uri),\n      passContext: true\n    });\n    (0, ajv_formats_1.default)(this._ajv);\n    for (const format of formats) {\n      this.addFormat(format);\n    }\n  }\n  _fetch(uri) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const maybeSchema = _this._uriCache.get(uri);\n      if (maybeSchema) {\n        return maybeSchema;\n      }\n      // Try all handlers, one after the other.\n      for (const handler of _this._uriHandlers) {\n        let handlerResult = handler(uri);\n        if (handlerResult === null || handlerResult === undefined) {\n          continue;\n        }\n        if ((0, rxjs_1.isObservable)(handlerResult)) {\n          handlerResult = (0, rxjs_1.lastValueFrom)(handlerResult);\n        }\n        const value = yield handlerResult;\n        _this._uriCache.set(uri, value);\n        return value;\n      }\n      // If none are found, handle using http client.\n      return new Promise((resolve, reject) => {\n        const url = new Url.URL(uri);\n        const client = url.protocol === 'https:' ? https : http;\n        client.get(url, res => {\n          if (!res.statusCode || res.statusCode >= 300) {\n            // Consume the rest of the data to free memory.\n            res.resume();\n            reject(new Error(`Request failed. Status Code: ${res.statusCode}`));\n          } else {\n            res.setEncoding('utf8');\n            let data = '';\n            res.on('data', chunk => {\n              data += chunk;\n            });\n            res.on('end', () => {\n              try {\n                const json = JSON.parse(data);\n                _this._uriCache.set(uri, json);\n                resolve(json);\n              } catch (err) {\n                reject(err);\n              }\n            });\n          }\n        });\n      });\n    })();\n  }\n  /**\n   * Add a transformation step before the validation of any Json.\n   * @param {JsonVisitor} visitor The visitor to transform every value.\n   * @param {JsonVisitor[]} deps A list of other visitors to run before.\n   */\n  addPreTransform(visitor, deps) {\n    this._pre.add(visitor, deps);\n  }\n  /**\n   * Add a transformation step after the validation of any Json. The JSON will not be validated\n   * after the POST, so if transformations are not compatible with the Schema it will not result\n   * in an error.\n   * @param {JsonVisitor} visitor The visitor to transform every value.\n   * @param {JsonVisitor[]} deps A list of other visitors to run before.\n   */\n  addPostTransform(visitor, deps) {\n    this._post.add(visitor, deps);\n  }\n  _resolver(ref, validate) {\n    if (!validate || !ref) {\n      return {};\n    }\n    const schema = validate.schemaEnv.root.schema;\n    const id = typeof schema === 'object' ? schema.$id : null;\n    let fullReference = ref;\n    if (typeof id === 'string') {\n      fullReference = Url.resolve(id, ref);\n      if (ref.startsWith('#')) {\n        fullReference = id + fullReference;\n      }\n    }\n    const resolvedSchema = this._ajv.getSchema(fullReference);\n    return {\n      context: resolvedSchema?.schemaEnv.validate,\n      schema: resolvedSchema?.schema\n    };\n  }\n  /**\n   * Flatten the Schema, resolving and replacing all the refs. Makes it into a synchronous schema\n   * that is also easier to traverse. Does not cache the result.\n   *\n   * Producing a flatten schema document does not in all cases produce a schema with identical behavior to the original.\n   * See: https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.appendix.B.2\n   *\n   * @param schema The schema or URI to flatten.\n   * @returns An Observable of the flattened schema object.\n   * @private since 11.2 without replacement.\n   */\n  Éµflatten(schema) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2._ajv.removeSchema(schema);\n      _this2._currentCompilationSchemaInfo = undefined;\n      const validate = yield _this2._ajv.compileAsync(schema);\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      const self = _this2;\n      function visitor(current, pointer, parentSchema, index) {\n        if (current && parentSchema && index && (0, utils_2.isJsonObject)(current) && Object.prototype.hasOwnProperty.call(current, '$ref') && typeof current['$ref'] == 'string') {\n          const resolved = self._resolver(current['$ref'], validate);\n          if (resolved.schema) {\n            parentSchema[index] = resolved.schema;\n          }\n        }\n      }\n      const schemaCopy = (0, utils_1.deepCopy)(validate.schema);\n      (0, visitor_1.visitJsonSchema)(schemaCopy, visitor);\n      return schemaCopy;\n    })();\n  }\n  /**\n   * Compile and return a validation function for the Schema.\n   *\n   * @param schema The schema to validate. If a string, will fetch the schema before compiling it\n   * (using schema as a URI).\n   */\n  compile(schema) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const validate = yield _this3._compile(schema);\n      return (value, options) => validate(value, options);\n    })();\n  }\n  _compile(schema) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      if (typeof schema === 'boolean') {\n        return /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (data) {\n            return {\n              success: schema,\n              data\n            };\n          });\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }();\n      }\n      const schemaInfo = {\n        smartDefaultRecord: new Map(),\n        promptDefinitions: []\n      };\n      _this4._ajv.removeSchema(schema);\n      let validator;\n      try {\n        _this4._currentCompilationSchemaInfo = schemaInfo;\n        validator = _this4._ajv.compile(schema);\n      } catch (e) {\n        // This should eventually be refactored so that we we handle race condition where the same schema is validated at the same time.\n        if (!(e instanceof ajv_1.default.MissingRefError)) {\n          throw e;\n        }\n        validator = yield _this4._ajv.compileAsync(schema);\n      } finally {\n        _this4._currentCompilationSchemaInfo = undefined;\n      }\n      return /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (data, options) {\n          const validationOptions = {\n            withPrompts: true,\n            applyPostTransforms: true,\n            applyPreTransforms: true,\n            ...options\n          };\n          const validationContext = {\n            promptFieldsWithValue: new Set()\n          };\n          // Apply pre-validation transforms\n          if (validationOptions.applyPreTransforms) {\n            for (const visitor of _this4._pre.values()) {\n              data = yield (0, rxjs_1.lastValueFrom)((0, visitor_1.visitJson)(data, visitor, schema, _this4._resolver.bind(_this4), validator));\n            }\n          }\n          // Apply smart defaults\n          yield _this4._applySmartDefaults(data, schemaInfo.smartDefaultRecord);\n          // Apply prompts\n          if (validationOptions.withPrompts) {\n            const visitor = (value, pointer) => {\n              if (value !== undefined) {\n                validationContext.promptFieldsWithValue.add(pointer);\n              }\n              return value;\n            };\n            if (typeof schema === 'object') {\n              yield (0, rxjs_1.lastValueFrom)((0, visitor_1.visitJson)(data, visitor, schema, _this4._resolver.bind(_this4), validator));\n            }\n            const definitions = schemaInfo.promptDefinitions.filter(def => !validationContext.promptFieldsWithValue.has(def.id));\n            if (definitions.length > 0) {\n              yield _this4._applyPrompts(data, definitions);\n            }\n          }\n          // Validate using ajv\n          try {\n            const success = yield validator.call(validationContext, data);\n            if (!success) {\n              return {\n                data,\n                success,\n                errors: validator.errors ?? []\n              };\n            }\n          } catch (error) {\n            if (error instanceof ajv_1.default.ValidationError) {\n              return {\n                data,\n                success: false,\n                errors: error.errors\n              };\n            }\n            throw error;\n          }\n          // Apply post-validation transforms\n          if (validationOptions.applyPostTransforms) {\n            for (const visitor of _this4._post.values()) {\n              data = yield (0, rxjs_1.lastValueFrom)((0, visitor_1.visitJson)(data, visitor, schema, _this4._resolver.bind(_this4), validator));\n            }\n          }\n          return {\n            data,\n            success: true\n          };\n        });\n        return function (_x2, _x3) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n    })();\n  }\n  addFormat(format) {\n    this._ajv.addFormat(format.name, format.formatter);\n  }\n  addSmartDefaultProvider(source, provider) {\n    if (this._sourceMap.has(source)) {\n      throw new Error(source);\n    }\n    this._sourceMap.set(source, provider);\n    if (!this._smartDefaultKeyword) {\n      this._smartDefaultKeyword = true;\n      this._ajv.addKeyword({\n        keyword: '$default',\n        errors: false,\n        valid: true,\n        compile: (schema, _parentSchema, it) => {\n          const compilationSchemInfo = this._currentCompilationSchemaInfo;\n          if (compilationSchemInfo === undefined) {\n            return () => true;\n          }\n          // We cheat, heavily.\n          const pathArray = this.normalizeDataPathArr(it);\n          compilationSchemInfo.smartDefaultRecord.set(JSON.stringify(pathArray), schema);\n          return () => true;\n        },\n        metaSchema: {\n          type: 'object',\n          properties: {\n            '$source': {\n              type: 'string'\n            }\n          },\n          additionalProperties: true,\n          required: ['$source']\n        }\n      });\n    }\n  }\n  registerUriHandler(handler) {\n    this._uriHandlers.add(handler);\n  }\n  usePromptProvider(provider) {\n    const isSetup = !!this._promptProvider;\n    this._promptProvider = provider;\n    if (isSetup) {\n      return;\n    }\n    this._ajv.addKeyword({\n      keyword: 'x-prompt',\n      errors: false,\n      valid: true,\n      compile: (schema, parentSchema, it) => {\n        const compilationSchemInfo = this._currentCompilationSchemaInfo;\n        if (!compilationSchemInfo) {\n          return () => true;\n        }\n        const path = '/' + this.normalizeDataPathArr(it).join('/');\n        let type;\n        let items;\n        let message;\n        if (typeof schema == 'string') {\n          message = schema;\n        } else {\n          message = schema.message;\n          type = schema.type;\n          items = schema.items;\n        }\n        const propertyTypes = (0, utility_1.getTypesOfSchema)(parentSchema);\n        if (!type) {\n          if (propertyTypes.size === 1 && propertyTypes.has('boolean')) {\n            type = 'confirmation';\n          } else if (Array.isArray(parentSchema.enum)) {\n            type = 'list';\n          } else if (propertyTypes.size === 1 && propertyTypes.has('array') && parentSchema.items && Array.isArray(parentSchema.items.enum)) {\n            type = 'list';\n          } else {\n            type = 'input';\n          }\n        }\n        let multiselect;\n        if (type === 'list') {\n          multiselect = schema.multiselect === undefined ? propertyTypes.size === 1 && propertyTypes.has('array') : schema.multiselect;\n          const enumValues = multiselect ? parentSchema.items && parentSchema.items.enum : parentSchema.enum;\n          if (!items && Array.isArray(enumValues)) {\n            items = [];\n            for (const value of enumValues) {\n              if (typeof value == 'string') {\n                items.push(value);\n              } else if (typeof value == 'object') {\n                // Invalid\n              } else {\n                items.push({\n                  label: value.toString(),\n                  value\n                });\n              }\n            }\n          }\n        }\n        const definition = {\n          id: path,\n          type,\n          message,\n          raw: schema,\n          items,\n          multiselect,\n          propertyTypes,\n          default: typeof parentSchema.default == 'object' && parentSchema.default !== null && !Array.isArray(parentSchema.default) ? undefined : parentSchema.default,\n          validator(data) {\n            return _asyncToGenerator(function* () {\n              try {\n                const result = yield it.self.validate(parentSchema, data);\n                // If the schema is sync then false will be returned on validation failure\n                if (result) {\n                  return result;\n                } else if (it.self.errors?.length) {\n                  // Validation errors will be present on the Ajv instance when sync\n                  return it.self.errors[0].message;\n                }\n              } catch (e) {\n                const validationError = e;\n                // If the schema is async then an error will be thrown on validation failure\n                if (Array.isArray(validationError.errors) && validationError.errors.length) {\n                  return validationError.errors[0].message;\n                }\n              }\n              return false;\n            })();\n          }\n        };\n        compilationSchemInfo.promptDefinitions.push(definition);\n        return function () {\n          // If 'this' is undefined in the call, then it defaults to the global\n          // 'this'.\n          if (this && this.promptFieldsWithValue) {\n            this.promptFieldsWithValue.add(path);\n          }\n          return true;\n        };\n      },\n      metaSchema: {\n        oneOf: [{\n          type: 'string'\n        }, {\n          type: 'object',\n          properties: {\n            'type': {\n              type: 'string'\n            },\n            'message': {\n              type: 'string'\n            }\n          },\n          additionalProperties: true,\n          required: ['message']\n        }]\n      }\n    });\n  }\n  _applyPrompts(data, prompts) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      const provider = _this5._promptProvider;\n      if (!provider) {\n        return;\n      }\n      const answers = yield (0, rxjs_1.lastValueFrom)((0, rxjs_1.from)(provider(prompts)));\n      for (const path in answers) {\n        const pathFragments = path.split('/').slice(1);\n        CoreSchemaRegistry._set(data, pathFragments, answers[path], null, undefined, true);\n      }\n    })();\n  }\n  static _set(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  data, fragments, value,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  parent = null, parentProperty, force) {\n    for (let index = 0; index < fragments.length; index++) {\n      const fragment = fragments[index];\n      if (/^i\\d+$/.test(fragment)) {\n        if (!Array.isArray(data)) {\n          return;\n        }\n        for (let dataIndex = 0; dataIndex < data.length; dataIndex++) {\n          CoreSchemaRegistry._set(data[dataIndex], fragments.slice(index + 1), value, data, `${dataIndex}`);\n        }\n        return;\n      }\n      if (!data && parent !== null && parentProperty) {\n        data = parent[parentProperty] = {};\n      }\n      parent = data;\n      parentProperty = fragment;\n      data = data[fragment];\n    }\n    if (parent && parentProperty && (force || parent[parentProperty] === undefined)) {\n      parent[parentProperty] = value;\n    }\n  }\n  _applySmartDefaults(data, smartDefaults) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      for (const [pointer, schema] of smartDefaults.entries()) {\n        const fragments = JSON.parse(pointer);\n        const source = _this6._sourceMap.get(schema.$source);\n        if (!source) {\n          continue;\n        }\n        let value = source(schema);\n        if ((0, rxjs_1.isObservable)(value)) {\n          value = yield (0, rxjs_1.lastValueFrom)(value);\n        }\n        CoreSchemaRegistry._set(data, fragments, value);\n      }\n    })();\n  }\n  useXDeprecatedProvider(onUsage) {\n    this._ajv.addKeyword({\n      keyword: 'x-deprecated',\n      validate: (schema, _data, _parentSchema, dataCxt) => {\n        if (schema) {\n          onUsage(`Option \"${dataCxt?.parentDataProperty}\" is deprecated${typeof schema == 'string' ? ': ' + schema : '.'}`);\n        }\n        return true;\n      },\n      errors: false\n    });\n  }\n  normalizeDataPathArr(it) {\n    return it.dataPathArr.slice(1, it.dataLevel + 1).map(p => typeof p === 'number' ? p : p.str.replace(/\"/g, ''));\n  }\n}\nexports.CoreSchemaRegistry = CoreSchemaRegistry;","map":{"version":3,"names":["_asyncToGenerator","require","default","__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","exports","CoreSchemaRegistry","SchemaValidationException","ajv_1","ajv_formats_1","http","https","rxjs_1","Url","exception_1","utils_1","utils_2","utility_1","visitor_1","BaseException","constructor","errors","baseMessage","length","messages","createMessages","join","map","err","message","JSON","stringify","instancePath","params","keyword","additionalProperty","allowedValues","formats","_uriCache","Map","_uriHandlers","Set","_pre","PartiallyOrderedSet","_post","_smartDefaultKeyword","_sourceMap","_ajv","strict","loadSchema","uri","_fetch","passContext","format","addFormat","_this","maybeSchema","handler","handlerResult","isObservable","lastValueFrom","set","Promise","resolve","reject","url","URL","client","protocol","res","statusCode","resume","Error","setEncoding","data","on","chunk","json","parse","addPreTransform","visitor","deps","add","addPostTransform","_resolver","ref","validate","schema","schemaEnv","root","id","$id","fullReference","startsWith","resolvedSchema","getSchema","context","Éµflatten","_this2","removeSchema","_currentCompilationSchemaInfo","compileAsync","self","current","pointer","parentSchema","index","isJsonObject","resolved","schemaCopy","deepCopy","visitJsonSchema","compile","_this3","_compile","options","_this4","_ref","success","_x","apply","arguments","schemaInfo","smartDefaultRecord","promptDefinitions","validator","e","MissingRefError","_ref2","validationOptions","withPrompts","applyPostTransforms","applyPreTransforms","validationContext","promptFieldsWithValue","values","visitJson","bind","_applySmartDefaults","definitions","filter","def","has","_applyPrompts","error","ValidationError","_x2","_x3","name","formatter","addSmartDefaultProvider","source","provider","addKeyword","valid","_parentSchema","it","compilationSchemInfo","pathArray","normalizeDataPathArr","metaSchema","type","properties","additionalProperties","required","registerUriHandler","usePromptProvider","isSetup","_promptProvider","path","items","propertyTypes","getTypesOfSchema","size","Array","isArray","enum","multiselect","enumValues","push","label","toString","definition","raw","validationError","oneOf","prompts","_this5","answers","from","pathFragments","split","slice","_set","fragments","parent","parentProperty","force","fragment","test","dataIndex","smartDefaults","_this6","entries","$source","useXDeprecatedProvider","onUsage","_data","dataCxt","parentDataProperty","dataPathArr","dataLevel","p","str","replace"],"sources":["C:/Users/GabrielFalisiewiczS/OneDrive/Dokumenty/Udemy/backend/kurs1/node_modules/@angular-devkit/core/src/json/schema/registry.js"],"sourcesContent":["\"use strict\";\n/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CoreSchemaRegistry = exports.SchemaValidationException = void 0;\nconst ajv_1 = __importDefault(require(\"ajv\"));\nconst ajv_formats_1 = __importDefault(require(\"ajv-formats\"));\nconst http = __importStar(require(\"http\"));\nconst https = __importStar(require(\"https\"));\nconst rxjs_1 = require(\"rxjs\");\nconst Url = __importStar(require(\"url\"));\nconst exception_1 = require(\"../../exception\");\nconst utils_1 = require(\"../../utils\");\nconst utils_2 = require(\"../utils\");\nconst utility_1 = require(\"./utility\");\nconst visitor_1 = require(\"./visitor\");\nclass SchemaValidationException extends exception_1.BaseException {\n    constructor(errors, baseMessage = 'Schema validation failed with the following errors:') {\n        if (!errors || errors.length === 0) {\n            super('Schema validation failed.');\n            this.errors = [];\n            return;\n        }\n        const messages = SchemaValidationException.createMessages(errors);\n        super(`${baseMessage}\\n  ${messages.join('\\n  ')}`);\n        this.errors = errors;\n    }\n    static createMessages(errors) {\n        if (!errors || errors.length === 0) {\n            return [];\n        }\n        const messages = errors.map((err) => {\n            let message = `Data path ${JSON.stringify(err.instancePath)} ${err.message}`;\n            if (err.params) {\n                switch (err.keyword) {\n                    case 'additionalProperties':\n                        message += `(${err.params.additionalProperty})`;\n                        break;\n                    case 'enum':\n                        message += `. Allowed values are: ${err.params.allowedValues\n                            ?.map((v) => `\"${v}\"`)\n                            .join(', ')}`;\n                        break;\n                }\n            }\n            return message + '.';\n        });\n        return messages;\n    }\n}\nexports.SchemaValidationException = SchemaValidationException;\nclass CoreSchemaRegistry {\n    constructor(formats = []) {\n        this._uriCache = new Map();\n        this._uriHandlers = new Set();\n        this._pre = new utils_1.PartiallyOrderedSet();\n        this._post = new utils_1.PartiallyOrderedSet();\n        this._smartDefaultKeyword = false;\n        this._sourceMap = new Map();\n        this._ajv = new ajv_1.default({\n            strict: false,\n            loadSchema: (uri) => this._fetch(uri),\n            passContext: true,\n        });\n        (0, ajv_formats_1.default)(this._ajv);\n        for (const format of formats) {\n            this.addFormat(format);\n        }\n    }\n    async _fetch(uri) {\n        const maybeSchema = this._uriCache.get(uri);\n        if (maybeSchema) {\n            return maybeSchema;\n        }\n        // Try all handlers, one after the other.\n        for (const handler of this._uriHandlers) {\n            let handlerResult = handler(uri);\n            if (handlerResult === null || handlerResult === undefined) {\n                continue;\n            }\n            if ((0, rxjs_1.isObservable)(handlerResult)) {\n                handlerResult = (0, rxjs_1.lastValueFrom)(handlerResult);\n            }\n            const value = await handlerResult;\n            this._uriCache.set(uri, value);\n            return value;\n        }\n        // If none are found, handle using http client.\n        return new Promise((resolve, reject) => {\n            const url = new Url.URL(uri);\n            const client = url.protocol === 'https:' ? https : http;\n            client.get(url, (res) => {\n                if (!res.statusCode || res.statusCode >= 300) {\n                    // Consume the rest of the data to free memory.\n                    res.resume();\n                    reject(new Error(`Request failed. Status Code: ${res.statusCode}`));\n                }\n                else {\n                    res.setEncoding('utf8');\n                    let data = '';\n                    res.on('data', (chunk) => {\n                        data += chunk;\n                    });\n                    res.on('end', () => {\n                        try {\n                            const json = JSON.parse(data);\n                            this._uriCache.set(uri, json);\n                            resolve(json);\n                        }\n                        catch (err) {\n                            reject(err);\n                        }\n                    });\n                }\n            });\n        });\n    }\n    /**\n     * Add a transformation step before the validation of any Json.\n     * @param {JsonVisitor} visitor The visitor to transform every value.\n     * @param {JsonVisitor[]} deps A list of other visitors to run before.\n     */\n    addPreTransform(visitor, deps) {\n        this._pre.add(visitor, deps);\n    }\n    /**\n     * Add a transformation step after the validation of any Json. The JSON will not be validated\n     * after the POST, so if transformations are not compatible with the Schema it will not result\n     * in an error.\n     * @param {JsonVisitor} visitor The visitor to transform every value.\n     * @param {JsonVisitor[]} deps A list of other visitors to run before.\n     */\n    addPostTransform(visitor, deps) {\n        this._post.add(visitor, deps);\n    }\n    _resolver(ref, validate) {\n        if (!validate || !ref) {\n            return {};\n        }\n        const schema = validate.schemaEnv.root.schema;\n        const id = typeof schema === 'object' ? schema.$id : null;\n        let fullReference = ref;\n        if (typeof id === 'string') {\n            fullReference = Url.resolve(id, ref);\n            if (ref.startsWith('#')) {\n                fullReference = id + fullReference;\n            }\n        }\n        const resolvedSchema = this._ajv.getSchema(fullReference);\n        return {\n            context: resolvedSchema?.schemaEnv.validate,\n            schema: resolvedSchema?.schema,\n        };\n    }\n    /**\n     * Flatten the Schema, resolving and replacing all the refs. Makes it into a synchronous schema\n     * that is also easier to traverse. Does not cache the result.\n     *\n     * Producing a flatten schema document does not in all cases produce a schema with identical behavior to the original.\n     * See: https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.appendix.B.2\n     *\n     * @param schema The schema or URI to flatten.\n     * @returns An Observable of the flattened schema object.\n     * @private since 11.2 without replacement.\n     */\n    async Éµflatten(schema) {\n        this._ajv.removeSchema(schema);\n        this._currentCompilationSchemaInfo = undefined;\n        const validate = await this._ajv.compileAsync(schema);\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const self = this;\n        function visitor(current, pointer, parentSchema, index) {\n            if (current &&\n                parentSchema &&\n                index &&\n                (0, utils_2.isJsonObject)(current) &&\n                Object.prototype.hasOwnProperty.call(current, '$ref') &&\n                typeof current['$ref'] == 'string') {\n                const resolved = self._resolver(current['$ref'], validate);\n                if (resolved.schema) {\n                    parentSchema[index] = resolved.schema;\n                }\n            }\n        }\n        const schemaCopy = (0, utils_1.deepCopy)(validate.schema);\n        (0, visitor_1.visitJsonSchema)(schemaCopy, visitor);\n        return schemaCopy;\n    }\n    /**\n     * Compile and return a validation function for the Schema.\n     *\n     * @param schema The schema to validate. If a string, will fetch the schema before compiling it\n     * (using schema as a URI).\n     */\n    async compile(schema) {\n        const validate = await this._compile(schema);\n        return (value, options) => validate(value, options);\n    }\n    async _compile(schema) {\n        if (typeof schema === 'boolean') {\n            return async (data) => ({ success: schema, data });\n        }\n        const schemaInfo = {\n            smartDefaultRecord: new Map(),\n            promptDefinitions: [],\n        };\n        this._ajv.removeSchema(schema);\n        let validator;\n        try {\n            this._currentCompilationSchemaInfo = schemaInfo;\n            validator = this._ajv.compile(schema);\n        }\n        catch (e) {\n            // This should eventually be refactored so that we we handle race condition where the same schema is validated at the same time.\n            if (!(e instanceof ajv_1.default.MissingRefError)) {\n                throw e;\n            }\n            validator = await this._ajv.compileAsync(schema);\n        }\n        finally {\n            this._currentCompilationSchemaInfo = undefined;\n        }\n        return async (data, options) => {\n            const validationOptions = {\n                withPrompts: true,\n                applyPostTransforms: true,\n                applyPreTransforms: true,\n                ...options,\n            };\n            const validationContext = {\n                promptFieldsWithValue: new Set(),\n            };\n            // Apply pre-validation transforms\n            if (validationOptions.applyPreTransforms) {\n                for (const visitor of this._pre.values()) {\n                    data = await (0, rxjs_1.lastValueFrom)((0, visitor_1.visitJson)(data, visitor, schema, this._resolver.bind(this), validator));\n                }\n            }\n            // Apply smart defaults\n            await this._applySmartDefaults(data, schemaInfo.smartDefaultRecord);\n            // Apply prompts\n            if (validationOptions.withPrompts) {\n                const visitor = (value, pointer) => {\n                    if (value !== undefined) {\n                        validationContext.promptFieldsWithValue.add(pointer);\n                    }\n                    return value;\n                };\n                if (typeof schema === 'object') {\n                    await (0, rxjs_1.lastValueFrom)((0, visitor_1.visitJson)(data, visitor, schema, this._resolver.bind(this), validator));\n                }\n                const definitions = schemaInfo.promptDefinitions.filter((def) => !validationContext.promptFieldsWithValue.has(def.id));\n                if (definitions.length > 0) {\n                    await this._applyPrompts(data, definitions);\n                }\n            }\n            // Validate using ajv\n            try {\n                const success = await validator.call(validationContext, data);\n                if (!success) {\n                    return { data, success, errors: validator.errors ?? [] };\n                }\n            }\n            catch (error) {\n                if (error instanceof ajv_1.default.ValidationError) {\n                    return { data, success: false, errors: error.errors };\n                }\n                throw error;\n            }\n            // Apply post-validation transforms\n            if (validationOptions.applyPostTransforms) {\n                for (const visitor of this._post.values()) {\n                    data = await (0, rxjs_1.lastValueFrom)((0, visitor_1.visitJson)(data, visitor, schema, this._resolver.bind(this), validator));\n                }\n            }\n            return { data, success: true };\n        };\n    }\n    addFormat(format) {\n        this._ajv.addFormat(format.name, format.formatter);\n    }\n    addSmartDefaultProvider(source, provider) {\n        if (this._sourceMap.has(source)) {\n            throw new Error(source);\n        }\n        this._sourceMap.set(source, provider);\n        if (!this._smartDefaultKeyword) {\n            this._smartDefaultKeyword = true;\n            this._ajv.addKeyword({\n                keyword: '$default',\n                errors: false,\n                valid: true,\n                compile: (schema, _parentSchema, it) => {\n                    const compilationSchemInfo = this._currentCompilationSchemaInfo;\n                    if (compilationSchemInfo === undefined) {\n                        return () => true;\n                    }\n                    // We cheat, heavily.\n                    const pathArray = this.normalizeDataPathArr(it);\n                    compilationSchemInfo.smartDefaultRecord.set(JSON.stringify(pathArray), schema);\n                    return () => true;\n                },\n                metaSchema: {\n                    type: 'object',\n                    properties: {\n                        '$source': { type: 'string' },\n                    },\n                    additionalProperties: true,\n                    required: ['$source'],\n                },\n            });\n        }\n    }\n    registerUriHandler(handler) {\n        this._uriHandlers.add(handler);\n    }\n    usePromptProvider(provider) {\n        const isSetup = !!this._promptProvider;\n        this._promptProvider = provider;\n        if (isSetup) {\n            return;\n        }\n        this._ajv.addKeyword({\n            keyword: 'x-prompt',\n            errors: false,\n            valid: true,\n            compile: (schema, parentSchema, it) => {\n                const compilationSchemInfo = this._currentCompilationSchemaInfo;\n                if (!compilationSchemInfo) {\n                    return () => true;\n                }\n                const path = '/' + this.normalizeDataPathArr(it).join('/');\n                let type;\n                let items;\n                let message;\n                if (typeof schema == 'string') {\n                    message = schema;\n                }\n                else {\n                    message = schema.message;\n                    type = schema.type;\n                    items = schema.items;\n                }\n                const propertyTypes = (0, utility_1.getTypesOfSchema)(parentSchema);\n                if (!type) {\n                    if (propertyTypes.size === 1 && propertyTypes.has('boolean')) {\n                        type = 'confirmation';\n                    }\n                    else if (Array.isArray(parentSchema.enum)) {\n                        type = 'list';\n                    }\n                    else if (propertyTypes.size === 1 &&\n                        propertyTypes.has('array') &&\n                        parentSchema.items &&\n                        Array.isArray(parentSchema.items.enum)) {\n                        type = 'list';\n                    }\n                    else {\n                        type = 'input';\n                    }\n                }\n                let multiselect;\n                if (type === 'list') {\n                    multiselect =\n                        schema.multiselect === undefined\n                            ? propertyTypes.size === 1 && propertyTypes.has('array')\n                            : schema.multiselect;\n                    const enumValues = multiselect\n                        ? parentSchema.items &&\n                            parentSchema.items.enum\n                        : parentSchema.enum;\n                    if (!items && Array.isArray(enumValues)) {\n                        items = [];\n                        for (const value of enumValues) {\n                            if (typeof value == 'string') {\n                                items.push(value);\n                            }\n                            else if (typeof value == 'object') {\n                                // Invalid\n                            }\n                            else {\n                                items.push({ label: value.toString(), value });\n                            }\n                        }\n                    }\n                }\n                const definition = {\n                    id: path,\n                    type,\n                    message,\n                    raw: schema,\n                    items,\n                    multiselect,\n                    propertyTypes,\n                    default: typeof parentSchema.default == 'object' &&\n                        parentSchema.default !== null &&\n                        !Array.isArray(parentSchema.default)\n                        ? undefined\n                        : parentSchema.default,\n                    async validator(data) {\n                        try {\n                            const result = await it.self.validate(parentSchema, data);\n                            // If the schema is sync then false will be returned on validation failure\n                            if (result) {\n                                return result;\n                            }\n                            else if (it.self.errors?.length) {\n                                // Validation errors will be present on the Ajv instance when sync\n                                return it.self.errors[0].message;\n                            }\n                        }\n                        catch (e) {\n                            const validationError = e;\n                            // If the schema is async then an error will be thrown on validation failure\n                            if (Array.isArray(validationError.errors) && validationError.errors.length) {\n                                return validationError.errors[0].message;\n                            }\n                        }\n                        return false;\n                    },\n                };\n                compilationSchemInfo.promptDefinitions.push(definition);\n                return function () {\n                    // If 'this' is undefined in the call, then it defaults to the global\n                    // 'this'.\n                    if (this && this.promptFieldsWithValue) {\n                        this.promptFieldsWithValue.add(path);\n                    }\n                    return true;\n                };\n            },\n            metaSchema: {\n                oneOf: [\n                    { type: 'string' },\n                    {\n                        type: 'object',\n                        properties: {\n                            'type': { type: 'string' },\n                            'message': { type: 'string' },\n                        },\n                        additionalProperties: true,\n                        required: ['message'],\n                    },\n                ],\n            },\n        });\n    }\n    async _applyPrompts(data, prompts) {\n        const provider = this._promptProvider;\n        if (!provider) {\n            return;\n        }\n        const answers = await (0, rxjs_1.lastValueFrom)((0, rxjs_1.from)(provider(prompts)));\n        for (const path in answers) {\n            const pathFragments = path.split('/').slice(1);\n            CoreSchemaRegistry._set(data, pathFragments, answers[path], null, undefined, true);\n        }\n    }\n    static _set(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data, fragments, value, \n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    parent = null, parentProperty, force) {\n        for (let index = 0; index < fragments.length; index++) {\n            const fragment = fragments[index];\n            if (/^i\\d+$/.test(fragment)) {\n                if (!Array.isArray(data)) {\n                    return;\n                }\n                for (let dataIndex = 0; dataIndex < data.length; dataIndex++) {\n                    CoreSchemaRegistry._set(data[dataIndex], fragments.slice(index + 1), value, data, `${dataIndex}`);\n                }\n                return;\n            }\n            if (!data && parent !== null && parentProperty) {\n                data = parent[parentProperty] = {};\n            }\n            parent = data;\n            parentProperty = fragment;\n            data = data[fragment];\n        }\n        if (parent && parentProperty && (force || parent[parentProperty] === undefined)) {\n            parent[parentProperty] = value;\n        }\n    }\n    async _applySmartDefaults(data, smartDefaults) {\n        for (const [pointer, schema] of smartDefaults.entries()) {\n            const fragments = JSON.parse(pointer);\n            const source = this._sourceMap.get(schema.$source);\n            if (!source) {\n                continue;\n            }\n            let value = source(schema);\n            if ((0, rxjs_1.isObservable)(value)) {\n                value = (await (0, rxjs_1.lastValueFrom)(value));\n            }\n            CoreSchemaRegistry._set(data, fragments, value);\n        }\n    }\n    useXDeprecatedProvider(onUsage) {\n        this._ajv.addKeyword({\n            keyword: 'x-deprecated',\n            validate: (schema, _data, _parentSchema, dataCxt) => {\n                if (schema) {\n                    onUsage(`Option \"${dataCxt?.parentDataProperty}\" is deprecated${typeof schema == 'string' ? ': ' + schema : '.'}`);\n                }\n                return true;\n            },\n            errors: false,\n        });\n    }\n    normalizeDataPathArr(it) {\n        return it.dataPathArr\n            .slice(1, it.dataLevel + 1)\n            .map((p) => (typeof p === 'number' ? p : p.str.replace(/\"/g, '')));\n    }\n}\nexports.CoreSchemaRegistry = CoreSchemaRegistry;\n"],"mappings":"AAAA,YAAY;;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AANA,IAAAA,iBAAA,GAAAC,OAAA,gIAAAC,OAAA;AAOA,IAAIC,eAAe,GAAI,IAAI,IAAI,IAAI,CAACA,eAAe,KAAMC,MAAM,CAACC,MAAM,GAAI,UAASC,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAEC,EAAE,EAAE;EAC5F,IAAIA,EAAE,KAAKC,SAAS,EAAED,EAAE,GAAGD,CAAC;EAC5B,IAAIG,IAAI,GAAGP,MAAM,CAACQ,wBAAwB,CAACL,CAAC,EAAEC,CAAC,CAAC;EAChD,IAAI,CAACG,IAAI,KAAK,KAAK,IAAIA,IAAI,GAAG,CAACJ,CAAC,CAACM,UAAU,GAAGF,IAAI,CAACG,QAAQ,IAAIH,IAAI,CAACI,YAAY,CAAC,EAAE;IACjFJ,IAAI,GAAG;MAAEK,UAAU,EAAE,IAAI;MAAEC,GAAG,EAAE,SAAAA,CAAA,EAAW;QAAE,OAAOV,CAAC,CAACC,CAAC,CAAC;MAAE;IAAE,CAAC;EAC/D;EACAJ,MAAM,CAACc,cAAc,CAACZ,CAAC,EAAEG,EAAE,EAAEE,IAAI,CAAC;AACtC,CAAC,GAAK,UAASL,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAEC,EAAE,EAAE;EACxB,IAAIA,EAAE,KAAKC,SAAS,EAAED,EAAE,GAAGD,CAAC;EAC5BF,CAAC,CAACG,EAAE,CAAC,GAAGF,CAAC,CAACC,CAAC,CAAC;AAChB,CAAE,CAAC;AACH,IAAIW,kBAAkB,GAAI,IAAI,IAAI,IAAI,CAACA,kBAAkB,KAAMf,MAAM,CAACC,MAAM,GAAI,UAASC,CAAC,EAAEc,CAAC,EAAE;EAC3FhB,MAAM,CAACc,cAAc,CAACZ,CAAC,EAAE,SAAS,EAAE;IAAEU,UAAU,EAAE,IAAI;IAAEK,KAAK,EAAED;EAAE,CAAC,CAAC;AACvE,CAAC,GAAI,UAASd,CAAC,EAAEc,CAAC,EAAE;EAChBd,CAAC,CAAC,SAAS,CAAC,GAAGc,CAAC;AACpB,CAAC,CAAC;AACF,IAAIE,YAAY,GAAI,IAAI,IAAI,IAAI,CAACA,YAAY,IAAK,UAAUC,GAAG,EAAE;EAC7D,IAAIA,GAAG,IAAIA,GAAG,CAACV,UAAU,EAAE,OAAOU,GAAG;EACrC,IAAIC,MAAM,GAAG,CAAC,CAAC;EACf,IAAID,GAAG,IAAI,IAAI,EAAE,KAAK,IAAIf,CAAC,IAAIe,GAAG,EAAE,IAAIf,CAAC,KAAK,SAAS,IAAIJ,MAAM,CAACqB,SAAS,CAACC,cAAc,CAACC,IAAI,CAACJ,GAAG,EAAEf,CAAC,CAAC,EAAEL,eAAe,CAACqB,MAAM,EAAED,GAAG,EAAEf,CAAC,CAAC;EACxIW,kBAAkB,CAACK,MAAM,EAAED,GAAG,CAAC;EAC/B,OAAOC,MAAM;AACjB,CAAC;AACD,IAAII,eAAe,GAAI,IAAI,IAAI,IAAI,CAACA,eAAe,IAAK,UAAUL,GAAG,EAAE;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACV,UAAU,GAAIU,GAAG,GAAG;IAAE,SAAS,EAAEA;EAAI,CAAC;AAC7D,CAAC;AACDnB,MAAM,CAACc,cAAc,CAACW,OAAO,EAAE,YAAY,EAAE;EAAER,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DQ,OAAO,CAACC,kBAAkB,GAAGD,OAAO,CAACE,yBAAyB,GAAG,KAAK,CAAC;AACvE,MAAMC,KAAK,GAAGJ,eAAe,CAAC3B,OAAO,CAAC,KAAK,CAAC,CAAC;AAC7C,MAAMgC,aAAa,GAAGL,eAAe,CAAC3B,OAAO,CAAC,aAAa,CAAC,CAAC;AAC7D,MAAMiC,IAAI,GAAGZ,YAAY,CAACrB,OAAO,CAAC,MAAM,CAAC,CAAC;AAC1C,MAAMkC,KAAK,GAAGb,YAAY,CAACrB,OAAO,CAAC,OAAO,CAAC,CAAC;AAC5C,MAAMmC,MAAM,GAAGnC,OAAO,CAAC,MAAM,CAAC;AAC9B,MAAMoC,GAAG,GAAGf,YAAY,CAACrB,OAAO,CAAC,KAAK,CAAC,CAAC;AACxC,MAAMqC,WAAW,GAAGrC,OAAO,CAAC,iBAAiB,CAAC;AAC9C,MAAMsC,OAAO,GAAGtC,OAAO,CAAC,aAAa,CAAC;AACtC,MAAMuC,OAAO,GAAGvC,OAAO,CAAC,UAAU,CAAC;AACnC,MAAMwC,SAAS,GAAGxC,OAAO,CAAC,WAAW,CAAC;AACtC,MAAMyC,SAAS,GAAGzC,OAAO,CAAC,WAAW,CAAC;AACtC,MAAM8B,yBAAyB,SAASO,WAAW,CAACK,aAAa,CAAC;EAC9DC,WAAWA,CAACC,MAAM,EAAEC,WAAW,GAAG,qDAAqD,EAAE;IACrF,IAAI,CAACD,MAAM,IAAIA,MAAM,CAACE,MAAM,KAAK,CAAC,EAAE;MAChC,KAAK,CAAC,2BAA2B,CAAC;MAClC,IAAI,CAACF,MAAM,GAAG,EAAE;MAChB;IACJ;IACA,MAAMG,QAAQ,GAAGjB,yBAAyB,CAACkB,cAAc,CAACJ,MAAM,CAAC;IACjE,KAAK,CAAE,GAAEC,WAAY,OAAME,QAAQ,CAACE,IAAI,CAAC,MAAM,CAAE,EAAC,CAAC;IACnD,IAAI,CAACL,MAAM,GAAGA,MAAM;EACxB;EACA,OAAOI,cAAcA,CAACJ,MAAM,EAAE;IAC1B,IAAI,CAACA,MAAM,IAAIA,MAAM,CAACE,MAAM,KAAK,CAAC,EAAE;MAChC,OAAO,EAAE;IACb;IACA,MAAMC,QAAQ,GAAGH,MAAM,CAACM,GAAG,CAAEC,GAAG,IAAK;MACjC,IAAIC,OAAO,GAAI,aAAYC,IAAI,CAACC,SAAS,CAACH,GAAG,CAACI,YAAY,CAAE,IAAGJ,GAAG,CAACC,OAAQ,EAAC;MAC5E,IAAID,GAAG,CAACK,MAAM,EAAE;QACZ,QAAQL,GAAG,CAACM,OAAO;UACf,KAAK,sBAAsB;YACvBL,OAAO,IAAK,IAAGD,GAAG,CAACK,MAAM,CAACE,kBAAmB,GAAE;YAC/C;UACJ,KAAK,MAAM;YACPN,OAAO,IAAK,yBAAwBD,GAAG,CAACK,MAAM,CAACG,aAAa,EACtDT,GAAG,CAAE/B,CAAC,IAAM,IAAGA,CAAE,GAAE,CAAC,CACrB8B,IAAI,CAAC,IAAI,CAAE,EAAC;YACjB;QACR;MACJ;MACA,OAAOG,OAAO,GAAG,GAAG;IACxB,CAAC,CAAC;IACF,OAAOL,QAAQ;EACnB;AACJ;AACAnB,OAAO,CAACE,yBAAyB,GAAGA,yBAAyB;AAC7D,MAAMD,kBAAkB,CAAC;EACrBc,WAAWA,CAACiB,OAAO,GAAG,EAAE,EAAE;IACtB,IAAI,CAACC,SAAS,GAAG,IAAIC,GAAG,CAAC,CAAC;IAC1B,IAAI,CAACC,YAAY,GAAG,IAAIC,GAAG,CAAC,CAAC;IAC7B,IAAI,CAACC,IAAI,GAAG,IAAI3B,OAAO,CAAC4B,mBAAmB,CAAC,CAAC;IAC7C,IAAI,CAACC,KAAK,GAAG,IAAI7B,OAAO,CAAC4B,mBAAmB,CAAC,CAAC;IAC9C,IAAI,CAACE,oBAAoB,GAAG,KAAK;IACjC,IAAI,CAACC,UAAU,GAAG,IAAIP,GAAG,CAAC,CAAC;IAC3B,IAAI,CAACQ,IAAI,GAAG,IAAIvC,KAAK,CAAC9B,OAAO,CAAC;MAC1BsE,MAAM,EAAE,KAAK;MACbC,UAAU,EAAGC,GAAG,IAAK,IAAI,CAACC,MAAM,CAACD,GAAG,CAAC;MACrCE,WAAW,EAAE;IACjB,CAAC,CAAC;IACF,CAAC,CAAC,EAAE3C,aAAa,CAAC/B,OAAO,EAAE,IAAI,CAACqE,IAAI,CAAC;IACrC,KAAK,MAAMM,MAAM,IAAIhB,OAAO,EAAE;MAC1B,IAAI,CAACiB,SAAS,CAACD,MAAM,CAAC;IAC1B;EACJ;EACMF,MAAMA,CAACD,GAAG,EAAE;IAAA,IAAAK,KAAA;IAAA,OAAA/E,iBAAA;MACd,MAAMgF,WAAW,GAAGD,KAAI,CAACjB,SAAS,CAAC7C,GAAG,CAACyD,GAAG,CAAC;MAC3C,IAAIM,WAAW,EAAE;QACb,OAAOA,WAAW;MACtB;MACA;MACA,KAAK,MAAMC,OAAO,IAAIF,KAAI,CAACf,YAAY,EAAE;QACrC,IAAIkB,aAAa,GAAGD,OAAO,CAACP,GAAG,CAAC;QAChC,IAAIQ,aAAa,KAAK,IAAI,IAAIA,aAAa,KAAKxE,SAAS,EAAE;UACvD;QACJ;QACA,IAAI,CAAC,CAAC,EAAE0B,MAAM,CAAC+C,YAAY,EAAED,aAAa,CAAC,EAAE;UACzCA,aAAa,GAAG,CAAC,CAAC,EAAE9C,MAAM,CAACgD,aAAa,EAAEF,aAAa,CAAC;QAC5D;QACA,MAAM7D,KAAK,SAAS6D,aAAa;QACjCH,KAAI,CAACjB,SAAS,CAACuB,GAAG,CAACX,GAAG,EAAErD,KAAK,CAAC;QAC9B,OAAOA,KAAK;MAChB;MACA;MACA,OAAO,IAAIiE,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACpC,MAAMC,GAAG,GAAG,IAAIpD,GAAG,CAACqD,GAAG,CAAChB,GAAG,CAAC;QAC5B,MAAMiB,MAAM,GAAGF,GAAG,CAACG,QAAQ,KAAK,QAAQ,GAAGzD,KAAK,GAAGD,IAAI;QACvDyD,MAAM,CAAC1E,GAAG,CAACwE,GAAG,EAAGI,GAAG,IAAK;UACrB,IAAI,CAACA,GAAG,CAACC,UAAU,IAAID,GAAG,CAACC,UAAU,IAAI,GAAG,EAAE;YAC1C;YACAD,GAAG,CAACE,MAAM,CAAC,CAAC;YACZP,MAAM,CAAC,IAAIQ,KAAK,CAAE,gCAA+BH,GAAG,CAACC,UAAW,EAAC,CAAC,CAAC;UACvE,CAAC,MACI;YACDD,GAAG,CAACI,WAAW,CAAC,MAAM,CAAC;YACvB,IAAIC,IAAI,GAAG,EAAE;YACbL,GAAG,CAACM,EAAE,CAAC,MAAM,EAAGC,KAAK,IAAK;cACtBF,IAAI,IAAIE,KAAK;YACjB,CAAC,CAAC;YACFP,GAAG,CAACM,EAAE,CAAC,KAAK,EAAE,MAAM;cAChB,IAAI;gBACA,MAAME,IAAI,GAAG/C,IAAI,CAACgD,KAAK,CAACJ,IAAI,CAAC;gBAC7BnB,KAAI,CAACjB,SAAS,CAACuB,GAAG,CAACX,GAAG,EAAE2B,IAAI,CAAC;gBAC7Bd,OAAO,CAACc,IAAI,CAAC;cACjB,CAAC,CACD,OAAOjD,GAAG,EAAE;gBACRoC,MAAM,CAACpC,GAAG,CAAC;cACf;YACJ,CAAC,CAAC;UACN;QACJ,CAAC,CAAC;MACN,CAAC,CAAC;IAAC;EACP;EACA;AACJ;AACA;AACA;AACA;EACImD,eAAeA,CAACC,OAAO,EAAEC,IAAI,EAAE;IAC3B,IAAI,CAACvC,IAAI,CAACwC,GAAG,CAACF,OAAO,EAAEC,IAAI,CAAC;EAChC;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;EACIE,gBAAgBA,CAACH,OAAO,EAAEC,IAAI,EAAE;IAC5B,IAAI,CAACrC,KAAK,CAACsC,GAAG,CAACF,OAAO,EAAEC,IAAI,CAAC;EACjC;EACAG,SAASA,CAACC,GAAG,EAAEC,QAAQ,EAAE;IACrB,IAAI,CAACA,QAAQ,IAAI,CAACD,GAAG,EAAE;MACnB,OAAO,CAAC,CAAC;IACb;IACA,MAAME,MAAM,GAAGD,QAAQ,CAACE,SAAS,CAACC,IAAI,CAACF,MAAM;IAC7C,MAAMG,EAAE,GAAG,OAAOH,MAAM,KAAK,QAAQ,GAAGA,MAAM,CAACI,GAAG,GAAG,IAAI;IACzD,IAAIC,aAAa,GAAGP,GAAG;IACvB,IAAI,OAAOK,EAAE,KAAK,QAAQ,EAAE;MACxBE,aAAa,GAAG/E,GAAG,CAACkD,OAAO,CAAC2B,EAAE,EAAEL,GAAG,CAAC;MACpC,IAAIA,GAAG,CAACQ,UAAU,CAAC,GAAG,CAAC,EAAE;QACrBD,aAAa,GAAGF,EAAE,GAAGE,aAAa;MACtC;IACJ;IACA,MAAME,cAAc,GAAG,IAAI,CAAC/C,IAAI,CAACgD,SAAS,CAACH,aAAa,CAAC;IACzD,OAAO;MACHI,OAAO,EAAEF,cAAc,EAAEN,SAAS,CAACF,QAAQ;MAC3CC,MAAM,EAAEO,cAAc,EAAEP;IAC5B,CAAC;EACL;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACUU,QAAQA,CAACV,MAAM,EAAE;IAAA,IAAAW,MAAA;IAAA,OAAA1H,iBAAA;MACnB0H,MAAI,CAACnD,IAAI,CAACoD,YAAY,CAACZ,MAAM,CAAC;MAC9BW,MAAI,CAACE,6BAA6B,GAAGlH,SAAS;MAC9C,MAAMoG,QAAQ,SAASY,MAAI,CAACnD,IAAI,CAACsD,YAAY,CAACd,MAAM,CAAC;MACrD;MACA,MAAMe,IAAI,GAAGJ,MAAI;MACjB,SAASlB,OAAOA,CAACuB,OAAO,EAAEC,OAAO,EAAEC,YAAY,EAAEC,KAAK,EAAE;QACpD,IAAIH,OAAO,IACPE,YAAY,IACZC,KAAK,IACL,CAAC,CAAC,EAAE1F,OAAO,CAAC2F,YAAY,EAAEJ,OAAO,CAAC,IAClC3H,MAAM,CAACqB,SAAS,CAACC,cAAc,CAACC,IAAI,CAACoG,OAAO,EAAE,MAAM,CAAC,IACrD,OAAOA,OAAO,CAAC,MAAM,CAAC,IAAI,QAAQ,EAAE;UACpC,MAAMK,QAAQ,GAAGN,IAAI,CAAClB,SAAS,CAACmB,OAAO,CAAC,MAAM,CAAC,EAAEjB,QAAQ,CAAC;UAC1D,IAAIsB,QAAQ,CAACrB,MAAM,EAAE;YACjBkB,YAAY,CAACC,KAAK,CAAC,GAAGE,QAAQ,CAACrB,MAAM;UACzC;QACJ;MACJ;MACA,MAAMsB,UAAU,GAAG,CAAC,CAAC,EAAE9F,OAAO,CAAC+F,QAAQ,EAAExB,QAAQ,CAACC,MAAM,CAAC;MACzD,CAAC,CAAC,EAAErE,SAAS,CAAC6F,eAAe,EAAEF,UAAU,EAAE7B,OAAO,CAAC;MACnD,OAAO6B,UAAU;IAAC;EACtB;EACA;AACJ;AACA;AACA;AACA;AACA;EACUG,OAAOA,CAACzB,MAAM,EAAE;IAAA,IAAA0B,MAAA;IAAA,OAAAzI,iBAAA;MAClB,MAAM8G,QAAQ,SAAS2B,MAAI,CAACC,QAAQ,CAAC3B,MAAM,CAAC;MAC5C,OAAO,CAAC1F,KAAK,EAAEsH,OAAO,KAAK7B,QAAQ,CAACzF,KAAK,EAAEsH,OAAO,CAAC;IAAC;EACxD;EACMD,QAAQA,CAAC3B,MAAM,EAAE;IAAA,IAAA6B,MAAA;IAAA,OAAA5I,iBAAA;MACnB,IAAI,OAAO+G,MAAM,KAAK,SAAS,EAAE;QAC7B;UAAA,IAAA8B,IAAA,GAAA7I,iBAAA,CAAO,WAAOkG,IAAI;YAAA,OAAM;cAAE4C,OAAO,EAAE/B,MAAM;cAAEb;YAAK,CAAC;UAAA,CAAC;UAAA,iBAAA6C,EAAA;YAAA,OAAAF,IAAA,CAAAG,KAAA,OAAAC,SAAA;UAAA;QAAA;MACtD;MACA,MAAMC,UAAU,GAAG;QACfC,kBAAkB,EAAE,IAAIpF,GAAG,CAAC,CAAC;QAC7BqF,iBAAiB,EAAE;MACvB,CAAC;MACDR,MAAI,CAACrE,IAAI,CAACoD,YAAY,CAACZ,MAAM,CAAC;MAC9B,IAAIsC,SAAS;MACb,IAAI;QACAT,MAAI,CAAChB,6BAA6B,GAAGsB,UAAU;QAC/CG,SAAS,GAAGT,MAAI,CAACrE,IAAI,CAACiE,OAAO,CAACzB,MAAM,CAAC;MACzC,CAAC,CACD,OAAOuC,CAAC,EAAE;QACN;QACA,IAAI,EAAEA,CAAC,YAAYtH,KAAK,CAAC9B,OAAO,CAACqJ,eAAe,CAAC,EAAE;UAC/C,MAAMD,CAAC;QACX;QACAD,SAAS,SAAST,MAAI,CAACrE,IAAI,CAACsD,YAAY,CAACd,MAAM,CAAC;MACpD,CAAC,SACO;QACJ6B,MAAI,CAAChB,6BAA6B,GAAGlH,SAAS;MAClD;MACA;QAAA,IAAA8I,KAAA,GAAAxJ,iBAAA,CAAO,WAAOkG,IAAI,EAAEyC,OAAO,EAAK;UAC5B,MAAMc,iBAAiB,GAAG;YACtBC,WAAW,EAAE,IAAI;YACjBC,mBAAmB,EAAE,IAAI;YACzBC,kBAAkB,EAAE,IAAI;YACxB,GAAGjB;UACP,CAAC;UACD,MAAMkB,iBAAiB,GAAG;YACtBC,qBAAqB,EAAE,IAAI7F,GAAG,CAAC;UACnC,CAAC;UACD;UACA,IAAIwF,iBAAiB,CAACG,kBAAkB,EAAE;YACtC,KAAK,MAAMpD,OAAO,IAAIoC,MAAI,CAAC1E,IAAI,CAAC6F,MAAM,CAAC,CAAC,EAAE;cACtC7D,IAAI,SAAS,CAAC,CAAC,EAAE9D,MAAM,CAACgD,aAAa,EAAE,CAAC,CAAC,EAAE1C,SAAS,CAACsH,SAAS,EAAE9D,IAAI,EAAEM,OAAO,EAAEO,MAAM,EAAE6B,MAAI,CAAChC,SAAS,CAACqD,IAAI,CAACrB,MAAI,CAAC,EAAES,SAAS,CAAC,CAAC;YACjI;UACJ;UACA;UACA,MAAMT,MAAI,CAACsB,mBAAmB,CAAChE,IAAI,EAAEgD,UAAU,CAACC,kBAAkB,CAAC;UACnE;UACA,IAAIM,iBAAiB,CAACC,WAAW,EAAE;YAC/B,MAAMlD,OAAO,GAAGA,CAACnF,KAAK,EAAE2G,OAAO,KAAK;cAChC,IAAI3G,KAAK,KAAKX,SAAS,EAAE;gBACrBmJ,iBAAiB,CAACC,qBAAqB,CAACpD,GAAG,CAACsB,OAAO,CAAC;cACxD;cACA,OAAO3G,KAAK;YAChB,CAAC;YACD,IAAI,OAAO0F,MAAM,KAAK,QAAQ,EAAE;cAC5B,MAAM,CAAC,CAAC,EAAE3E,MAAM,CAACgD,aAAa,EAAE,CAAC,CAAC,EAAE1C,SAAS,CAACsH,SAAS,EAAE9D,IAAI,EAAEM,OAAO,EAAEO,MAAM,EAAE6B,MAAI,CAAChC,SAAS,CAACqD,IAAI,CAACrB,MAAI,CAAC,EAAES,SAAS,CAAC,CAAC;YAC1H;YACA,MAAMc,WAAW,GAAGjB,UAAU,CAACE,iBAAiB,CAACgB,MAAM,CAAEC,GAAG,IAAK,CAACR,iBAAiB,CAACC,qBAAqB,CAACQ,GAAG,CAACD,GAAG,CAACnD,EAAE,CAAC,CAAC;YACtH,IAAIiD,WAAW,CAACpH,MAAM,GAAG,CAAC,EAAE;cACxB,MAAM6F,MAAI,CAAC2B,aAAa,CAACrE,IAAI,EAAEiE,WAAW,CAAC;YAC/C;UACJ;UACA;UACA,IAAI;YACA,MAAMrB,OAAO,SAASO,SAAS,CAAC1H,IAAI,CAACkI,iBAAiB,EAAE3D,IAAI,CAAC;YAC7D,IAAI,CAAC4C,OAAO,EAAE;cACV,OAAO;gBAAE5C,IAAI;gBAAE4C,OAAO;gBAAEjG,MAAM,EAAEwG,SAAS,CAACxG,MAAM,IAAI;cAAG,CAAC;YAC5D;UACJ,CAAC,CACD,OAAO2H,KAAK,EAAE;YACV,IAAIA,KAAK,YAAYxI,KAAK,CAAC9B,OAAO,CAACuK,eAAe,EAAE;cAChD,OAAO;gBAAEvE,IAAI;gBAAE4C,OAAO,EAAE,KAAK;gBAAEjG,MAAM,EAAE2H,KAAK,CAAC3H;cAAO,CAAC;YACzD;YACA,MAAM2H,KAAK;UACf;UACA;UACA,IAAIf,iBAAiB,CAACE,mBAAmB,EAAE;YACvC,KAAK,MAAMnD,OAAO,IAAIoC,MAAI,CAACxE,KAAK,CAAC2F,MAAM,CAAC,CAAC,EAAE;cACvC7D,IAAI,SAAS,CAAC,CAAC,EAAE9D,MAAM,CAACgD,aAAa,EAAE,CAAC,CAAC,EAAE1C,SAAS,CAACsH,SAAS,EAAE9D,IAAI,EAAEM,OAAO,EAAEO,MAAM,EAAE6B,MAAI,CAAChC,SAAS,CAACqD,IAAI,CAACrB,MAAI,CAAC,EAAES,SAAS,CAAC,CAAC;YACjI;UACJ;UACA,OAAO;YAAEnD,IAAI;YAAE4C,OAAO,EAAE;UAAK,CAAC;QAClC,CAAC;QAAA,iBAAA4B,GAAA,EAAAC,GAAA;UAAA,OAAAnB,KAAA,CAAAR,KAAA,OAAAC,SAAA;QAAA;MAAA;IAAC;EACN;EACAnE,SAASA,CAACD,MAAM,EAAE;IACd,IAAI,CAACN,IAAI,CAACO,SAAS,CAACD,MAAM,CAAC+F,IAAI,EAAE/F,MAAM,CAACgG,SAAS,CAAC;EACtD;EACAC,uBAAuBA,CAACC,MAAM,EAAEC,QAAQ,EAAE;IACtC,IAAI,IAAI,CAAC1G,UAAU,CAACgG,GAAG,CAACS,MAAM,CAAC,EAAE;MAC7B,MAAM,IAAI/E,KAAK,CAAC+E,MAAM,CAAC;IAC3B;IACA,IAAI,CAACzG,UAAU,CAACe,GAAG,CAAC0F,MAAM,EAAEC,QAAQ,CAAC;IACrC,IAAI,CAAC,IAAI,CAAC3G,oBAAoB,EAAE;MAC5B,IAAI,CAACA,oBAAoB,GAAG,IAAI;MAChC,IAAI,CAACE,IAAI,CAAC0G,UAAU,CAAC;QACjBvH,OAAO,EAAE,UAAU;QACnBb,MAAM,EAAE,KAAK;QACbqI,KAAK,EAAE,IAAI;QACX1C,OAAO,EAAEA,CAACzB,MAAM,EAAEoE,aAAa,EAAEC,EAAE,KAAK;UACpC,MAAMC,oBAAoB,GAAG,IAAI,CAACzD,6BAA6B;UAC/D,IAAIyD,oBAAoB,KAAK3K,SAAS,EAAE;YACpC,OAAO,MAAM,IAAI;UACrB;UACA;UACA,MAAM4K,SAAS,GAAG,IAAI,CAACC,oBAAoB,CAACH,EAAE,CAAC;UAC/CC,oBAAoB,CAAClC,kBAAkB,CAAC9D,GAAG,CAAC/B,IAAI,CAACC,SAAS,CAAC+H,SAAS,CAAC,EAAEvE,MAAM,CAAC;UAC9E,OAAO,MAAM,IAAI;QACrB,CAAC;QACDyE,UAAU,EAAE;UACRC,IAAI,EAAE,QAAQ;UACdC,UAAU,EAAE;YACR,SAAS,EAAE;cAAED,IAAI,EAAE;YAAS;UAChC,CAAC;UACDE,oBAAoB,EAAE,IAAI;UAC1BC,QAAQ,EAAE,CAAC,SAAS;QACxB;MACJ,CAAC,CAAC;IACN;EACJ;EACAC,kBAAkBA,CAAC5G,OAAO,EAAE;IACxB,IAAI,CAACjB,YAAY,CAAC0C,GAAG,CAACzB,OAAO,CAAC;EAClC;EACA6G,iBAAiBA,CAACd,QAAQ,EAAE;IACxB,MAAMe,OAAO,GAAG,CAAC,CAAC,IAAI,CAACC,eAAe;IACtC,IAAI,CAACA,eAAe,GAAGhB,QAAQ;IAC/B,IAAIe,OAAO,EAAE;MACT;IACJ;IACA,IAAI,CAACxH,IAAI,CAAC0G,UAAU,CAAC;MACjBvH,OAAO,EAAE,UAAU;MACnBb,MAAM,EAAE,KAAK;MACbqI,KAAK,EAAE,IAAI;MACX1C,OAAO,EAAEA,CAACzB,MAAM,EAAEkB,YAAY,EAAEmD,EAAE,KAAK;QACnC,MAAMC,oBAAoB,GAAG,IAAI,CAACzD,6BAA6B;QAC/D,IAAI,CAACyD,oBAAoB,EAAE;UACvB,OAAO,MAAM,IAAI;QACrB;QACA,MAAMY,IAAI,GAAG,GAAG,GAAG,IAAI,CAACV,oBAAoB,CAACH,EAAE,CAAC,CAAClI,IAAI,CAAC,GAAG,CAAC;QAC1D,IAAIuI,IAAI;QACR,IAAIS,KAAK;QACT,IAAI7I,OAAO;QACX,IAAI,OAAO0D,MAAM,IAAI,QAAQ,EAAE;UAC3B1D,OAAO,GAAG0D,MAAM;QACpB,CAAC,MACI;UACD1D,OAAO,GAAG0D,MAAM,CAAC1D,OAAO;UACxBoI,IAAI,GAAG1E,MAAM,CAAC0E,IAAI;UAClBS,KAAK,GAAGnF,MAAM,CAACmF,KAAK;QACxB;QACA,MAAMC,aAAa,GAAG,CAAC,CAAC,EAAE1J,SAAS,CAAC2J,gBAAgB,EAAEnE,YAAY,CAAC;QACnE,IAAI,CAACwD,IAAI,EAAE;UACP,IAAIU,aAAa,CAACE,IAAI,KAAK,CAAC,IAAIF,aAAa,CAAC7B,GAAG,CAAC,SAAS,CAAC,EAAE;YAC1DmB,IAAI,GAAG,cAAc;UACzB,CAAC,MACI,IAAIa,KAAK,CAACC,OAAO,CAACtE,YAAY,CAACuE,IAAI,CAAC,EAAE;YACvCf,IAAI,GAAG,MAAM;UACjB,CAAC,MACI,IAAIU,aAAa,CAACE,IAAI,KAAK,CAAC,IAC7BF,aAAa,CAAC7B,GAAG,CAAC,OAAO,CAAC,IAC1BrC,YAAY,CAACiE,KAAK,IAClBI,KAAK,CAACC,OAAO,CAACtE,YAAY,CAACiE,KAAK,CAACM,IAAI,CAAC,EAAE;YACxCf,IAAI,GAAG,MAAM;UACjB,CAAC,MACI;YACDA,IAAI,GAAG,OAAO;UAClB;QACJ;QACA,IAAIgB,WAAW;QACf,IAAIhB,IAAI,KAAK,MAAM,EAAE;UACjBgB,WAAW,GACP1F,MAAM,CAAC0F,WAAW,KAAK/L,SAAS,GAC1ByL,aAAa,CAACE,IAAI,KAAK,CAAC,IAAIF,aAAa,CAAC7B,GAAG,CAAC,OAAO,CAAC,GACtDvD,MAAM,CAAC0F,WAAW;UAC5B,MAAMC,UAAU,GAAGD,WAAW,GACxBxE,YAAY,CAACiE,KAAK,IAChBjE,YAAY,CAACiE,KAAK,CAACM,IAAI,GACzBvE,YAAY,CAACuE,IAAI;UACvB,IAAI,CAACN,KAAK,IAAII,KAAK,CAACC,OAAO,CAACG,UAAU,CAAC,EAAE;YACrCR,KAAK,GAAG,EAAE;YACV,KAAK,MAAM7K,KAAK,IAAIqL,UAAU,EAAE;cAC5B,IAAI,OAAOrL,KAAK,IAAI,QAAQ,EAAE;gBAC1B6K,KAAK,CAACS,IAAI,CAACtL,KAAK,CAAC;cACrB,CAAC,MACI,IAAI,OAAOA,KAAK,IAAI,QAAQ,EAAE;gBAC/B;cAAA,CACH,MACI;gBACD6K,KAAK,CAACS,IAAI,CAAC;kBAAEC,KAAK,EAAEvL,KAAK,CAACwL,QAAQ,CAAC,CAAC;kBAAExL;gBAAM,CAAC,CAAC;cAClD;YACJ;UACJ;QACJ;QACA,MAAMyL,UAAU,GAAG;UACf5F,EAAE,EAAE+E,IAAI;UACRR,IAAI;UACJpI,OAAO;UACP0J,GAAG,EAAEhG,MAAM;UACXmF,KAAK;UACLO,WAAW;UACXN,aAAa;UACbjM,OAAO,EAAE,OAAO+H,YAAY,CAAC/H,OAAO,IAAI,QAAQ,IAC5C+H,YAAY,CAAC/H,OAAO,KAAK,IAAI,IAC7B,CAACoM,KAAK,CAACC,OAAO,CAACtE,YAAY,CAAC/H,OAAO,CAAC,GAClCQ,SAAS,GACTuH,YAAY,CAAC/H,OAAO;UACpBmJ,SAASA,CAACnD,IAAI,EAAE;YAAA,OAAAlG,iBAAA;cAClB,IAAI;gBACA,MAAMwB,MAAM,SAAS4J,EAAE,CAACtD,IAAI,CAAChB,QAAQ,CAACmB,YAAY,EAAE/B,IAAI,CAAC;gBACzD;gBACA,IAAI1E,MAAM,EAAE;kBACR,OAAOA,MAAM;gBACjB,CAAC,MACI,IAAI4J,EAAE,CAACtD,IAAI,CAACjF,MAAM,EAAEE,MAAM,EAAE;kBAC7B;kBACA,OAAOqI,EAAE,CAACtD,IAAI,CAACjF,MAAM,CAAC,CAAC,CAAC,CAACQ,OAAO;gBACpC;cACJ,CAAC,CACD,OAAOiG,CAAC,EAAE;gBACN,MAAM0D,eAAe,GAAG1D,CAAC;gBACzB;gBACA,IAAIgD,KAAK,CAACC,OAAO,CAACS,eAAe,CAACnK,MAAM,CAAC,IAAImK,eAAe,CAACnK,MAAM,CAACE,MAAM,EAAE;kBACxE,OAAOiK,eAAe,CAACnK,MAAM,CAAC,CAAC,CAAC,CAACQ,OAAO;gBAC5C;cACJ;cACA,OAAO,KAAK;YAAC;UACjB;QACJ,CAAC;QACDgI,oBAAoB,CAACjC,iBAAiB,CAACuD,IAAI,CAACG,UAAU,CAAC;QACvD,OAAO,YAAY;UACf;UACA;UACA,IAAI,IAAI,IAAI,IAAI,CAAChD,qBAAqB,EAAE;YACpC,IAAI,CAACA,qBAAqB,CAACpD,GAAG,CAACuF,IAAI,CAAC;UACxC;UACA,OAAO,IAAI;QACf,CAAC;MACL,CAAC;MACDT,UAAU,EAAE;QACRyB,KAAK,EAAE,CACH;UAAExB,IAAI,EAAE;QAAS,CAAC,EAClB;UACIA,IAAI,EAAE,QAAQ;UACdC,UAAU,EAAE;YACR,MAAM,EAAE;cAAED,IAAI,EAAE;YAAS,CAAC;YAC1B,SAAS,EAAE;cAAEA,IAAI,EAAE;YAAS;UAChC,CAAC;UACDE,oBAAoB,EAAE,IAAI;UAC1BC,QAAQ,EAAE,CAAC,SAAS;QACxB,CAAC;MAET;IACJ,CAAC,CAAC;EACN;EACMrB,aAAaA,CAACrE,IAAI,EAAEgH,OAAO,EAAE;IAAA,IAAAC,MAAA;IAAA,OAAAnN,iBAAA;MAC/B,MAAMgL,QAAQ,GAAGmC,MAAI,CAACnB,eAAe;MACrC,IAAI,CAAChB,QAAQ,EAAE;QACX;MACJ;MACA,MAAMoC,OAAO,SAAS,CAAC,CAAC,EAAEhL,MAAM,CAACgD,aAAa,EAAE,CAAC,CAAC,EAAEhD,MAAM,CAACiL,IAAI,EAAErC,QAAQ,CAACkC,OAAO,CAAC,CAAC,CAAC;MACpF,KAAK,MAAMjB,IAAI,IAAImB,OAAO,EAAE;QACxB,MAAME,aAAa,GAAGrB,IAAI,CAACsB,KAAK,CAAC,GAAG,CAAC,CAACC,KAAK,CAAC,CAAC,CAAC;QAC9C1L,kBAAkB,CAAC2L,IAAI,CAACvH,IAAI,EAAEoH,aAAa,EAAEF,OAAO,CAACnB,IAAI,CAAC,EAAE,IAAI,EAAEvL,SAAS,EAAE,IAAI,CAAC;MACtF;IAAC;EACL;EACA,OAAO+M,IAAIA;EACX;EACAvH,IAAI,EAAEwH,SAAS,EAAErM,KAAK;EACtB;EACAsM,MAAM,GAAG,IAAI,EAAEC,cAAc,EAAEC,KAAK,EAAE;IAClC,KAAK,IAAI3F,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAGwF,SAAS,CAAC3K,MAAM,EAAEmF,KAAK,EAAE,EAAE;MACnD,MAAM4F,QAAQ,GAAGJ,SAAS,CAACxF,KAAK,CAAC;MACjC,IAAI,QAAQ,CAAC6F,IAAI,CAACD,QAAQ,CAAC,EAAE;QACzB,IAAI,CAACxB,KAAK,CAACC,OAAO,CAACrG,IAAI,CAAC,EAAE;UACtB;QACJ;QACA,KAAK,IAAI8H,SAAS,GAAG,CAAC,EAAEA,SAAS,GAAG9H,IAAI,CAACnD,MAAM,EAAEiL,SAAS,EAAE,EAAE;UAC1DlM,kBAAkB,CAAC2L,IAAI,CAACvH,IAAI,CAAC8H,SAAS,CAAC,EAAEN,SAAS,CAACF,KAAK,CAACtF,KAAK,GAAG,CAAC,CAAC,EAAE7G,KAAK,EAAE6E,IAAI,EAAG,GAAE8H,SAAU,EAAC,CAAC;QACrG;QACA;MACJ;MACA,IAAI,CAAC9H,IAAI,IAAIyH,MAAM,KAAK,IAAI,IAAIC,cAAc,EAAE;QAC5C1H,IAAI,GAAGyH,MAAM,CAACC,cAAc,CAAC,GAAG,CAAC,CAAC;MACtC;MACAD,MAAM,GAAGzH,IAAI;MACb0H,cAAc,GAAGE,QAAQ;MACzB5H,IAAI,GAAGA,IAAI,CAAC4H,QAAQ,CAAC;IACzB;IACA,IAAIH,MAAM,IAAIC,cAAc,KAAKC,KAAK,IAAIF,MAAM,CAACC,cAAc,CAAC,KAAKlN,SAAS,CAAC,EAAE;MAC7EiN,MAAM,CAACC,cAAc,CAAC,GAAGvM,KAAK;IAClC;EACJ;EACM6I,mBAAmBA,CAAChE,IAAI,EAAE+H,aAAa,EAAE;IAAA,IAAAC,MAAA;IAAA,OAAAlO,iBAAA;MAC3C,KAAK,MAAM,CAACgI,OAAO,EAAEjB,MAAM,CAAC,IAAIkH,aAAa,CAACE,OAAO,CAAC,CAAC,EAAE;QACrD,MAAMT,SAAS,GAAGpK,IAAI,CAACgD,KAAK,CAAC0B,OAAO,CAAC;QACrC,MAAM+C,MAAM,GAAGmD,MAAI,CAAC5J,UAAU,CAACrD,GAAG,CAAC8F,MAAM,CAACqH,OAAO,CAAC;QAClD,IAAI,CAACrD,MAAM,EAAE;UACT;QACJ;QACA,IAAI1J,KAAK,GAAG0J,MAAM,CAAChE,MAAM,CAAC;QAC1B,IAAI,CAAC,CAAC,EAAE3E,MAAM,CAAC+C,YAAY,EAAE9D,KAAK,CAAC,EAAE;UACjCA,KAAK,SAAU,CAAC,CAAC,EAAEe,MAAM,CAACgD,aAAa,EAAE/D,KAAK,CAAE;QACpD;QACAS,kBAAkB,CAAC2L,IAAI,CAACvH,IAAI,EAAEwH,SAAS,EAAErM,KAAK,CAAC;MACnD;IAAC;EACL;EACAgN,sBAAsBA,CAACC,OAAO,EAAE;IAC5B,IAAI,CAAC/J,IAAI,CAAC0G,UAAU,CAAC;MACjBvH,OAAO,EAAE,cAAc;MACvBoD,QAAQ,EAAEA,CAACC,MAAM,EAAEwH,KAAK,EAAEpD,aAAa,EAAEqD,OAAO,KAAK;QACjD,IAAIzH,MAAM,EAAE;UACRuH,OAAO,CAAE,WAAUE,OAAO,EAAEC,kBAAmB,kBAAiB,OAAO1H,MAAM,IAAI,QAAQ,GAAG,IAAI,GAAGA,MAAM,GAAG,GAAI,EAAC,CAAC;QACtH;QACA,OAAO,IAAI;MACf,CAAC;MACDlE,MAAM,EAAE;IACZ,CAAC,CAAC;EACN;EACA0I,oBAAoBA,CAACH,EAAE,EAAE;IACrB,OAAOA,EAAE,CAACsD,WAAW,CAChBlB,KAAK,CAAC,CAAC,EAAEpC,EAAE,CAACuD,SAAS,GAAG,CAAC,CAAC,CAC1BxL,GAAG,CAAEyL,CAAC,IAAM,OAAOA,CAAC,KAAK,QAAQ,GAAGA,CAAC,GAAGA,CAAC,CAACC,GAAG,CAACC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAE,CAAC;EAC1E;AACJ;AACAjN,OAAO,CAACC,kBAAkB,GAAGA,kBAAkB"},"metadata":{},"sourceType":"script","externalDependencies":[]}