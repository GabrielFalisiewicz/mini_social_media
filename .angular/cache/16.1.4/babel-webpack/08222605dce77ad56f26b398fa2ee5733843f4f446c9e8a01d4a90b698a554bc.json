{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Delegations = void 0;\nconst util_1 = __importDefault(require(\"util\"));\nconst error_1 = require(\"./error\");\nconst key_1 = require(\"./key\");\nconst role_1 = require(\"./role\");\nconst utils_1 = require(\"./utils\");\n/**\n * A container object storing information about all delegations.\n *\n * Targets roles that are trusted to provide signed metadata files\n * describing targets with designated pathnames and/or further delegations.\n */\nclass Delegations {\n  constructor(options) {\n    this.keys = options.keys;\n    this.unrecognizedFields = options.unrecognizedFields || {};\n    if (options.roles) {\n      if (Object.keys(options.roles).some(roleName => role_1.TOP_LEVEL_ROLE_NAMES.includes(roleName))) {\n        throw new error_1.ValueError('Delegated role name conflicts with top-level role name');\n      }\n    }\n    this.succinctRoles = options.succinctRoles;\n    this.roles = options.roles;\n  }\n  equals(other) {\n    if (!(other instanceof Delegations)) {\n      return false;\n    }\n    return util_1.default.isDeepStrictEqual(this.keys, other.keys) && util_1.default.isDeepStrictEqual(this.roles, other.roles) && util_1.default.isDeepStrictEqual(this.unrecognizedFields, other.unrecognizedFields) && util_1.default.isDeepStrictEqual(this.succinctRoles, other.succinctRoles);\n  }\n  *rolesForTarget(targetPath) {\n    if (this.roles) {\n      for (const role of Object.values(this.roles)) {\n        if (role.isDelegatedPath(targetPath)) {\n          yield {\n            role: role.name,\n            terminating: role.terminating\n          };\n        }\n      }\n    } else if (this.succinctRoles) {\n      yield {\n        role: this.succinctRoles.getRoleForTarget(targetPath),\n        terminating: true\n      };\n    }\n  }\n  toJSON() {\n    const json = {\n      keys: keysToJSON(this.keys),\n      ...this.unrecognizedFields\n    };\n    if (this.roles) {\n      json.roles = rolesToJSON(this.roles);\n    } else if (this.succinctRoles) {\n      json.succinct_roles = this.succinctRoles.toJSON();\n    }\n    return json;\n  }\n  static fromJSON(data) {\n    const {\n      keys,\n      roles,\n      succinct_roles,\n      ...unrecognizedFields\n    } = data;\n    let succinctRoles;\n    if (utils_1.guard.isObject(succinct_roles)) {\n      succinctRoles = role_1.SuccinctRoles.fromJSON(succinct_roles);\n    }\n    return new Delegations({\n      keys: keysFromJSON(keys),\n      roles: rolesFromJSON(roles),\n      unrecognizedFields,\n      succinctRoles\n    });\n  }\n}\nexports.Delegations = Delegations;\nfunction keysToJSON(keys) {\n  return Object.entries(keys).reduce((acc, [keyId, key]) => ({\n    ...acc,\n    [keyId]: key.toJSON()\n  }), {});\n}\nfunction rolesToJSON(roles) {\n  return Object.values(roles).map(role => role.toJSON());\n}\nfunction keysFromJSON(data) {\n  if (!utils_1.guard.isObjectRecord(data)) {\n    throw new TypeError('keys is malformed');\n  }\n  return Object.entries(data).reduce((acc, [keyID, keyData]) => ({\n    ...acc,\n    [keyID]: key_1.Key.fromJSON(keyID, keyData)\n  }), {});\n}\nfunction rolesFromJSON(data) {\n  let roleMap;\n  if (utils_1.guard.isDefined(data)) {\n    if (!utils_1.guard.isObjectArray(data)) {\n      throw new TypeError('roles is malformed');\n    }\n    roleMap = data.reduce((acc, role) => {\n      const delegatedRole = role_1.DelegatedRole.fromJSON(role);\n      return {\n        ...acc,\n        [delegatedRole.name]: delegatedRole\n      };\n    }, {});\n  }\n  return roleMap;\n}","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","Delegations","util_1","require","error_1","key_1","role_1","utils_1","constructor","options","keys","unrecognizedFields","roles","some","roleName","TOP_LEVEL_ROLE_NAMES","includes","ValueError","succinctRoles","equals","other","default","isDeepStrictEqual","rolesForTarget","targetPath","role","values","isDelegatedPath","name","terminating","getRoleForTarget","toJSON","json","keysToJSON","rolesToJSON","succinct_roles","fromJSON","data","guard","isObject","SuccinctRoles","keysFromJSON","rolesFromJSON","entries","reduce","acc","keyId","key","map","isObjectRecord","TypeError","keyID","keyData","Key","roleMap","isDefined","isObjectArray","delegatedRole","DelegatedRole"],"sources":["C:/Users/GabrielFalisiewiczS/OneDrive/Dokumenty/Udemy/backend/kurs1/node_modules/@tufjs/models/dist/delegations.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Delegations = void 0;\nconst util_1 = __importDefault(require(\"util\"));\nconst error_1 = require(\"./error\");\nconst key_1 = require(\"./key\");\nconst role_1 = require(\"./role\");\nconst utils_1 = require(\"./utils\");\n/**\n * A container object storing information about all delegations.\n *\n * Targets roles that are trusted to provide signed metadata files\n * describing targets with designated pathnames and/or further delegations.\n */\nclass Delegations {\n    constructor(options) {\n        this.keys = options.keys;\n        this.unrecognizedFields = options.unrecognizedFields || {};\n        if (options.roles) {\n            if (Object.keys(options.roles).some((roleName) => role_1.TOP_LEVEL_ROLE_NAMES.includes(roleName))) {\n                throw new error_1.ValueError('Delegated role name conflicts with top-level role name');\n            }\n        }\n        this.succinctRoles = options.succinctRoles;\n        this.roles = options.roles;\n    }\n    equals(other) {\n        if (!(other instanceof Delegations)) {\n            return false;\n        }\n        return (util_1.default.isDeepStrictEqual(this.keys, other.keys) &&\n            util_1.default.isDeepStrictEqual(this.roles, other.roles) &&\n            util_1.default.isDeepStrictEqual(this.unrecognizedFields, other.unrecognizedFields) &&\n            util_1.default.isDeepStrictEqual(this.succinctRoles, other.succinctRoles));\n    }\n    *rolesForTarget(targetPath) {\n        if (this.roles) {\n            for (const role of Object.values(this.roles)) {\n                if (role.isDelegatedPath(targetPath)) {\n                    yield { role: role.name, terminating: role.terminating };\n                }\n            }\n        }\n        else if (this.succinctRoles) {\n            yield {\n                role: this.succinctRoles.getRoleForTarget(targetPath),\n                terminating: true,\n            };\n        }\n    }\n    toJSON() {\n        const json = {\n            keys: keysToJSON(this.keys),\n            ...this.unrecognizedFields,\n        };\n        if (this.roles) {\n            json.roles = rolesToJSON(this.roles);\n        }\n        else if (this.succinctRoles) {\n            json.succinct_roles = this.succinctRoles.toJSON();\n        }\n        return json;\n    }\n    static fromJSON(data) {\n        const { keys, roles, succinct_roles, ...unrecognizedFields } = data;\n        let succinctRoles;\n        if (utils_1.guard.isObject(succinct_roles)) {\n            succinctRoles = role_1.SuccinctRoles.fromJSON(succinct_roles);\n        }\n        return new Delegations({\n            keys: keysFromJSON(keys),\n            roles: rolesFromJSON(roles),\n            unrecognizedFields,\n            succinctRoles,\n        });\n    }\n}\nexports.Delegations = Delegations;\nfunction keysToJSON(keys) {\n    return Object.entries(keys).reduce((acc, [keyId, key]) => ({\n        ...acc,\n        [keyId]: key.toJSON(),\n    }), {});\n}\nfunction rolesToJSON(roles) {\n    return Object.values(roles).map((role) => role.toJSON());\n}\nfunction keysFromJSON(data) {\n    if (!utils_1.guard.isObjectRecord(data)) {\n        throw new TypeError('keys is malformed');\n    }\n    return Object.entries(data).reduce((acc, [keyID, keyData]) => ({\n        ...acc,\n        [keyID]: key_1.Key.fromJSON(keyID, keyData),\n    }), {});\n}\nfunction rolesFromJSON(data) {\n    let roleMap;\n    if (utils_1.guard.isDefined(data)) {\n        if (!utils_1.guard.isObjectArray(data)) {\n            throw new TypeError('roles is malformed');\n        }\n        roleMap = data.reduce((acc, role) => {\n            const delegatedRole = role_1.DelegatedRole.fromJSON(role);\n            return {\n                ...acc,\n                [delegatedRole.name]: delegatedRole,\n            };\n        }, {});\n    }\n    return roleMap;\n}\n"],"mappings":"AAAA,YAAY;;AACZ,IAAIA,eAAe,GAAI,IAAI,IAAI,IAAI,CAACA,eAAe,IAAK,UAAUC,GAAG,EAAE;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACC,UAAU,GAAID,GAAG,GAAG;IAAE,SAAS,EAAEA;EAAI,CAAC;AAC7D,CAAC;AACDE,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,WAAW,GAAG,KAAK,CAAC;AAC5B,MAAMC,MAAM,GAAGR,eAAe,CAACS,OAAO,CAAC,MAAM,CAAC,CAAC;AAC/C,MAAMC,OAAO,GAAGD,OAAO,CAAC,SAAS,CAAC;AAClC,MAAME,KAAK,GAAGF,OAAO,CAAC,OAAO,CAAC;AAC9B,MAAMG,MAAM,GAAGH,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMI,OAAO,GAAGJ,OAAO,CAAC,SAAS,CAAC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA,MAAMF,WAAW,CAAC;EACdO,WAAWA,CAACC,OAAO,EAAE;IACjB,IAAI,CAACC,IAAI,GAAGD,OAAO,CAACC,IAAI;IACxB,IAAI,CAACC,kBAAkB,GAAGF,OAAO,CAACE,kBAAkB,IAAI,CAAC,CAAC;IAC1D,IAAIF,OAAO,CAACG,KAAK,EAAE;MACf,IAAIf,MAAM,CAACa,IAAI,CAACD,OAAO,CAACG,KAAK,CAAC,CAACC,IAAI,CAAEC,QAAQ,IAAKR,MAAM,CAACS,oBAAoB,CAACC,QAAQ,CAACF,QAAQ,CAAC,CAAC,EAAE;QAC/F,MAAM,IAAIV,OAAO,CAACa,UAAU,CAAC,wDAAwD,CAAC;MAC1F;IACJ;IACA,IAAI,CAACC,aAAa,GAAGT,OAAO,CAACS,aAAa;IAC1C,IAAI,CAACN,KAAK,GAAGH,OAAO,CAACG,KAAK;EAC9B;EACAO,MAAMA,CAACC,KAAK,EAAE;IACV,IAAI,EAAEA,KAAK,YAAYnB,WAAW,CAAC,EAAE;MACjC,OAAO,KAAK;IAChB;IACA,OAAQC,MAAM,CAACmB,OAAO,CAACC,iBAAiB,CAAC,IAAI,CAACZ,IAAI,EAAEU,KAAK,CAACV,IAAI,CAAC,IAC3DR,MAAM,CAACmB,OAAO,CAACC,iBAAiB,CAAC,IAAI,CAACV,KAAK,EAAEQ,KAAK,CAACR,KAAK,CAAC,IACzDV,MAAM,CAACmB,OAAO,CAACC,iBAAiB,CAAC,IAAI,CAACX,kBAAkB,EAAES,KAAK,CAACT,kBAAkB,CAAC,IACnFT,MAAM,CAACmB,OAAO,CAACC,iBAAiB,CAAC,IAAI,CAACJ,aAAa,EAAEE,KAAK,CAACF,aAAa,CAAC;EACjF;EACA,CAACK,cAAcA,CAACC,UAAU,EAAE;IACxB,IAAI,IAAI,CAACZ,KAAK,EAAE;MACZ,KAAK,MAAMa,IAAI,IAAI5B,MAAM,CAAC6B,MAAM,CAAC,IAAI,CAACd,KAAK,CAAC,EAAE;QAC1C,IAAIa,IAAI,CAACE,eAAe,CAACH,UAAU,CAAC,EAAE;UAClC,MAAM;YAAEC,IAAI,EAAEA,IAAI,CAACG,IAAI;YAAEC,WAAW,EAAEJ,IAAI,CAACI;UAAY,CAAC;QAC5D;MACJ;IACJ,CAAC,MACI,IAAI,IAAI,CAACX,aAAa,EAAE;MACzB,MAAM;QACFO,IAAI,EAAE,IAAI,CAACP,aAAa,CAACY,gBAAgB,CAACN,UAAU,CAAC;QACrDK,WAAW,EAAE;MACjB,CAAC;IACL;EACJ;EACAE,MAAMA,CAAA,EAAG;IACL,MAAMC,IAAI,GAAG;MACTtB,IAAI,EAAEuB,UAAU,CAAC,IAAI,CAACvB,IAAI,CAAC;MAC3B,GAAG,IAAI,CAACC;IACZ,CAAC;IACD,IAAI,IAAI,CAACC,KAAK,EAAE;MACZoB,IAAI,CAACpB,KAAK,GAAGsB,WAAW,CAAC,IAAI,CAACtB,KAAK,CAAC;IACxC,CAAC,MACI,IAAI,IAAI,CAACM,aAAa,EAAE;MACzBc,IAAI,CAACG,cAAc,GAAG,IAAI,CAACjB,aAAa,CAACa,MAAM,CAAC,CAAC;IACrD;IACA,OAAOC,IAAI;EACf;EACA,OAAOI,QAAQA,CAACC,IAAI,EAAE;IAClB,MAAM;MAAE3B,IAAI;MAAEE,KAAK;MAAEuB,cAAc;MAAE,GAAGxB;IAAmB,CAAC,GAAG0B,IAAI;IACnE,IAAInB,aAAa;IACjB,IAAIX,OAAO,CAAC+B,KAAK,CAACC,QAAQ,CAACJ,cAAc,CAAC,EAAE;MACxCjB,aAAa,GAAGZ,MAAM,CAACkC,aAAa,CAACJ,QAAQ,CAACD,cAAc,CAAC;IACjE;IACA,OAAO,IAAIlC,WAAW,CAAC;MACnBS,IAAI,EAAE+B,YAAY,CAAC/B,IAAI,CAAC;MACxBE,KAAK,EAAE8B,aAAa,CAAC9B,KAAK,CAAC;MAC3BD,kBAAkB;MAClBO;IACJ,CAAC,CAAC;EACN;AACJ;AACAnB,OAAO,CAACE,WAAW,GAAGA,WAAW;AACjC,SAASgC,UAAUA,CAACvB,IAAI,EAAE;EACtB,OAAOb,MAAM,CAAC8C,OAAO,CAACjC,IAAI,CAAC,CAACkC,MAAM,CAAC,CAACC,GAAG,EAAE,CAACC,KAAK,EAAEC,GAAG,CAAC,MAAM;IACvD,GAAGF,GAAG;IACN,CAACC,KAAK,GAAGC,GAAG,CAAChB,MAAM,CAAC;EACxB,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACX;AACA,SAASG,WAAWA,CAACtB,KAAK,EAAE;EACxB,OAAOf,MAAM,CAAC6B,MAAM,CAACd,KAAK,CAAC,CAACoC,GAAG,CAAEvB,IAAI,IAAKA,IAAI,CAACM,MAAM,CAAC,CAAC,CAAC;AAC5D;AACA,SAASU,YAAYA,CAACJ,IAAI,EAAE;EACxB,IAAI,CAAC9B,OAAO,CAAC+B,KAAK,CAACW,cAAc,CAACZ,IAAI,CAAC,EAAE;IACrC,MAAM,IAAIa,SAAS,CAAC,mBAAmB,CAAC;EAC5C;EACA,OAAOrD,MAAM,CAAC8C,OAAO,CAACN,IAAI,CAAC,CAACO,MAAM,CAAC,CAACC,GAAG,EAAE,CAACM,KAAK,EAAEC,OAAO,CAAC,MAAM;IAC3D,GAAGP,GAAG;IACN,CAACM,KAAK,GAAG9C,KAAK,CAACgD,GAAG,CAACjB,QAAQ,CAACe,KAAK,EAAEC,OAAO;EAC9C,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACX;AACA,SAASV,aAAaA,CAACL,IAAI,EAAE;EACzB,IAAIiB,OAAO;EACX,IAAI/C,OAAO,CAAC+B,KAAK,CAACiB,SAAS,CAAClB,IAAI,CAAC,EAAE;IAC/B,IAAI,CAAC9B,OAAO,CAAC+B,KAAK,CAACkB,aAAa,CAACnB,IAAI,CAAC,EAAE;MACpC,MAAM,IAAIa,SAAS,CAAC,oBAAoB,CAAC;IAC7C;IACAI,OAAO,GAAGjB,IAAI,CAACO,MAAM,CAAC,CAACC,GAAG,EAAEpB,IAAI,KAAK;MACjC,MAAMgC,aAAa,GAAGnD,MAAM,CAACoD,aAAa,CAACtB,QAAQ,CAACX,IAAI,CAAC;MACzD,OAAO;QACH,GAAGoB,GAAG;QACN,CAACY,aAAa,CAAC7B,IAAI,GAAG6B;MAC1B,CAAC;IACL,CAAC,EAAE,CAAC,CAAC,CAAC;EACV;EACA,OAAOH,OAAO;AAClB"},"metadata":{},"sourceType":"script","externalDependencies":[]}